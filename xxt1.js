/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /gh/qcxs/chaoxing@master/app.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
class ToolClass{static tipTimeOut;static TipElement;static print(e,t,o){"object"==typeof e&&(e=JSON.stringify(e));const n=document.createElement("div");n.style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10002",n.onclick=()=>n.remove();const r="function"==typeof t;var s;n.innerHTML=`\n<div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.15);z-index:10000;width:80%;max-height:70%;min-height:200px;box-sizing:border-box;display:flex;flex-direction:column;">\n  <span style="position:absolute;top:10px;right:15px;font-size:18px;cursor:pointer;color:#999" onclick="this.closest('div').parentNode.remove()">×</span>\n  <label style="display:block;margin:10px 0 8px;font-size:16px;font-weight:bold;color:#333">${o||"查看或复制："}</label>\n  <div id="contentArea" style="overflow-y:auto;min-height:80px;white-space:pre-wrap;word-wrap:break-word;flex:1;${r?"user-modify: read-write; -webkit-user-modify: read-write; outline: none; cursor: text;":""}">${s=e,s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}</div>\n  <div style="margin-top:10px;text-align:right;">\n    <button style="padding:5px 10px;border:1px solid #ccc;border-radius:4px;background:#fff;cursor:pointer;margin-right:5px" onclick="this.closest('div').parentNode.parentNode.remove()">取消</button>\n    <button id="actionBtn" style="padding:5px 10px;border:1px solid #ccc;border-radius:4px;background:#fff;cursor:pointer">${r?"确定":"复制"}</button>\n  </div>\n</div>\n`,document.body.appendChild(n);const i=n.querySelector("#contentArea"),l=n.querySelector("#actionBtn");n.querySelector("div").addEventListener("click",(e=>e.stopPropagation())),l.addEventListener("click",(()=>{if(r){const e=i.textContent;t(e)}else ToolClass.copy(e);n.remove()}))}static showTip(e){clearTimeout(this.tipTimeOut),this.TipElement||(this.TipElement=document.createElement("div"),this.TipElement.style.cssText="position:fixed;top:30px;right:20px;color:white;padding:10px;background:#888;border-radius:4px;z-index:10001",document.body.appendChild(this.TipElement),this.TipElement.addEventListener("click",(e=>{e.stopPropagation(),window.AdvancedWebTool.showItemsMenu(),this.TipElement.style.display="none"}))),this.TipElement.textContent=e,this.tipTimeOut=setTimeout((()=>this.TipElement.style.display="none"),2e3),this.TipElement.style.display="block"}static copy(e){const t=document.createElement("textarea");t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.readOnly=!0,e=e.replace(/\xA0/g," "),t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,e.length);try{document.execCommand("copy")}catch(e){console.log("无法复制："+e)}document.body.removeChild(t)}static getElementSelectedText(e){if(!(e instanceof HTMLElement))return console.error("请传入有效的DOM元素"),"";const t=window.getSelection(),o=document.createRange();o.selectNodeContents(e),t.removeAllRanges(),t.addRange(o);const n=t.toString();return t.removeAllRanges(),n}static recConsoleLog(){if("function(){}"==window.console.log.toString().trim()){const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e),window.console.log=e.contentWindow.console.log,console.log("恢复log成功")}}static loadScript(e,t){function o(e){try{const t=new URL(e);return t.search="",t.toString()}catch(t){const o=e.indexOf("?");return o>-1?e.slice(0,o):e}}const n=o(e),r=document.getElementsByTagName("script");for(let e=0;e<r.length;e++){const t=r[e].src;if(t&&o(t)===n)return}const s=document.createElement("script");s.src=e,s.type="text/javascript",s.onload=function(){"function"==typeof t&&t()},s.onerror=function(){console.error(`Failed to load script: ${e}`)},document.head.appendChild(s)}static loadUrl(){this.print(window.location.href,(e=>{e.trim()&&window.location.href!==e&&(window.location.href=e)}),"请输入url：")}}class ExamProcessor{constructor(){this.examData=[]}parseExam(){const e=document.querySelectorAll(".allAnswerList.questionWrap");return 0===e.length?(console.log("未找到题目容器"),[]):(this.examData=[],Array.from(e).forEach((e=>{const t=e.getAttribute("data")||"unknown_id",o=e.querySelector('input[name^="typeName"]'),n=o?o.value:"未知题型";if(!["单选题","多选题","判断题"].includes(n))return;const r=e.querySelector(".tit");let s="";if(r){s=(r.querySelector("p")||r).textContent.replace(/(\d+)\./,"").trim()}const i={questionId:t,questionType:n,questionContent:s,options:[],selectedContents:[]};this.parseChoiceQuestion(e,i),this.examData.push(i)})),this.examData)}parseChoiceQuestion(e,t){e.querySelectorAll(".answerList").forEach((e=>{const o=e.querySelector(".answerInfo")?.textContent.trim()||"";t.options.push(o),e.classList.contains("on")&&t.selectedContents.push(o)}))}exportJson(){return this.parseExam(),JSON.stringify(this.examData)}importJson(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return void console.error("导入数据格式错误，应为数组");const o=new Map;t.forEach((e=>{e.questionId&&o.set(e.questionId,e)}));document.querySelectorAll(".allAnswerList.questionWrap").forEach((e=>{const t=e.getAttribute("data");if(!t)return;const n=o.get(t);n&&["单选题","多选题","判断题"].includes(n.questionType)&&this.restoreChoiceAnswer(e,n)})),console.log("选择题/判断题答案恢复完成")}catch(e){console.error("导入失败：",e)}}importAnswersByString(e){const t=e.split(/\s+/).filter((e=>""!==e.trim()));if(0===t.length)return void console.error("输入字符串格式错误，未找到有效选项");const o=document.querySelectorAll(".allAnswerList.questionWrap");if(0===o.length)return void console.error("未找到题目容器");let n=0;Array.from(o).forEach(((e,o)=>{const r=e.querySelector('input[name^="typeName"]'),s=r?r.value:"";if(!["单选题","多选题","判断题"].includes(s))return void console.log(`第${o+1}题（${s}）不是选择/判断题，跳过`);if(n>=t.length)return void console.log(`选项已用完，剩余题目（从第${o+1}题开始）未匹配`);console.log(`为第${o+1}题（${s}）匹配选项：${t[n]}`);const i={selectedContents:this._parseAnswerToContents(e,t[n])};this.restoreChoiceAnswer(e,i),n++})),n<t.length?console.warn(`尚有${t.length-n}个选项未匹配（可能题目数量不足或类型不匹配）`):console.log(`已完成所有${n}个选项的匹配`)}_parseAnswerToContents(e,t){const o=e.querySelectorAll(".answerList"),n=[];return o.forEach(((e,o)=>{const r=String.fromCharCode(65+o);if(t.includes(r)){const t=e.querySelector(".answerInfo")?.textContent.trim()||"";n.push(t)}})),n}restoreChoiceAnswer(e,t){e.querySelectorAll(".answerList.on").forEach((e=>{$(e).trigger("tap")})),e.querySelectorAll(".answerList").forEach((e=>{const o=e.querySelector(".answerInfo")?.textContent.trim()||"";t.selectedContents.includes(o)&&$(e).trigger("tap")}))}}class InClassExerciseProcessor{constructor(){this.examData=[]}parseExam(){this.examData=[];let e=document.querySelectorAll(".answer-item");if(0===e.length){const t=document.querySelector(".van-swipe__track");t&&(e=t.querySelectorAll(".quiz-item"))}return 0===e.length?(console.log("未找到题目容器"),[]):(Array.from(e).forEach(((e,t)=>{const o=e.classList.contains("answer-item"),n=e.classList.contains("quiz-item"),r=this._getQuestionType(e,o);if(!["单选题","多选题","判断题"].includes(r))return;const s={questionId:`exam_question_${t+1}_${r}`,questionType:r,questionContent:this._getQuestionContent(e,o),options:this._getOptionValues(e,o),myAnswerValues:[],correctAnswerValues:[]};if(o)s.myAnswerValues=this._parseAnsweringValues(e);else if(n){const{myValues:t,correctValues:o}=this._parseAnsweredValues(e,s.options);s.myAnswerValues=t,s.correctAnswerValues=o}this.examData.push(s)})),this.examData)}importAnswersByString(e){const t=e.split(/\s+/).filter((e=>""!==e.trim()));if(0===t.length)return void console.error("输入字符串格式错误，未找到有效答案");let o=document.querySelectorAll(".answer-item");if(0===o.length){const e=document.querySelector(".van-swipe__track");e&&(o=e.querySelectorAll(".quiz-item"))}if(0===o.length)return void console.error("未找到题目容器，无法导入答案");let n=0;Array.from(o).forEach(((e,o)=>{const r=e.classList.contains("answer-item"),s=this._getQuestionType(e,r);if(!["单选题","多选题","判断题"].includes(s))return void console.log(`第${o+1}题（${s}）不是选择/判断题，跳过`);if(n>=t.length)return void console.log(`答案已用完，剩余题目（从第${o+1}题开始）未匹配`);const{options:i,codeToValueMap:l}=this._getOptionsWithCodeMap(e,r);if(0===i.length)return void console.log(`第${o+1}题未找到有效选项，跳过`);const a=t[n],c=this._parseAnswerToValues(a,i,l,s);c.length>0?(console.log(`为第${o+1}题（${s}）匹配答案：${a}`),this._restoreAnswerByValues(e,r,c),n++):console.log(`第${o+1}题未找到与"${a}"匹配的选项，跳过`)})),n<t.length?console.warn(`尚有${t.length-n}个答案未匹配`):console.log(`已完成所有${n}个答案的匹配`)}_getOptionsWithCodeMap(e,t){const o=[],n=new Map,r=e.querySelectorAll(".quiz-options .option-item");return Array.from(r).forEach(((e,r)=>{let s="";const i=e.querySelector(".html-content-box");if(i)s=i.textContent.trim();else{s=e.textContent.trim().replace(/^[A-Z]\./,"").trim()}s&&o.push(s);let l="";if(t){const t=e.querySelector(".option-name");l=t?t.textContent.trim():""}else{const t=e.textContent.trim().match(/^([A-Z])\./);l=t?t[1]:""}!l&&r<26&&(l=String.fromCharCode("A".charCodeAt(0)+r)),l&&s&&n.set(l,s)})),{options:o,codeToValueMap:n}}_parseAnswerToValues(e,t,o,n){if("判断题"===n&&2===t.length){const[o,n]=t,r="对"===o||"错"===n?o:t[0],s="错"===o||"对"===n?o:t[1];if(["A","对"].includes(e))return[r];if(["B","错"].includes(e))return[s]}const r=[];for(const t of e)o.has(t)&&r.push(o.get(t));if(r.length>0)return r;const s=("多选题"===n?e.split(/\s+/):[e]).filter((e=>t.includes(e.trim())));return s.length>0?s:[]}_getQuestionType(e,t){const o=t?".answer-title .gray":".quiz-title .gray",n=e.querySelector(o);return n?n.textContent.replace(/\[|\]/g,"").trim():"未知题型"}_getQuestionContent(e,t){const o=t?".answer-title .html-content-box p":".quiz-title .html-content-box p",n=e.querySelector(o);return n?n.textContent.trim():"未知题目"}_getOptionValues(e,t){const o=[],n=e.querySelectorAll(".quiz-options .option-item");return Array.from(n).forEach((e=>{let t="";const n=e.querySelector(".html-content-box");if(n)t=n.textContent.trim();else{t=e.textContent.trim().replace(/^[A-Z]\./,"").trim()}t&&o.push(t)})),o}_parseAnsweringValues(e){const t=[],o=e.querySelectorAll(".quiz-options .option-item.active");return Array.from(o).forEach((e=>{const o=e.querySelector(".html-content-box");if(o)t.push(o.textContent.trim());else{const o=e.textContent.trim();t.push(o.replace(/^[A-Z]\./,"").trim())}})),t}_parseAnsweredValues(e,t){const o=this._getAnswerText(e,".quiz-answer .answer-title span"),n=this._matchAnswerToValues(o,t),r=this._getAnswerText(e,".correct-answer .answer-title span");return{myValues:n,correctValues:this._matchAnswerToValues(r,t)}}_getAnswerText(e,t){const o=e.querySelector(t);return o?o.textContent.replace(/[^\u4e00-\u9fa5A-Za-z0-9]/g,"").trim():""}_matchAnswerToValues(e,t){if(!e)return[];const o=t.filter((t=>t===e));if(o.length>0)return o;if(2===t.length&&["对","错"].every((e=>t.includes(e)))){if("A"===e||"对"===e)return["对"];if("B"===e||"错"===e)return["错"]}const n=[];for(const o of e){const e=o.charCodeAt(0)-"A".charCodeAt(0);e>=0&&e<t.length&&n.push(t[e])}return n}exportJson(){return this.parseExam(),JSON.stringify(this.examData)}importJson(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return void console.error("导入数据格式错误，应为数组");const o=new Map;t.forEach((e=>{e.questionId&&o.set(e.questionId,e)}));let n=document.querySelectorAll(".answer-item");if(0===n.length){const e=document.querySelector(".van-swipe__track");e&&(n=e.querySelectorAll(".quiz-item"))}if(0===n.length)return void console.error("未找到题目容器，无法恢复答案");Array.from(n).forEach(((e,t)=>{const n=e.classList.contains("answer-item"),r=`exam_question_${t+1}_${this._getQuestionType(e,n)}`,s=o.get(r);if(!s)return;const i=s.correctAnswerValues.length>0?s.correctAnswerValues:s.myAnswerValues;i.length>0&&this._restoreAnswerByValues(e,n,i)})),console.log("答案恢复完成")}catch(e){console.error("导入失败：",e)}}_restoreAnswerByValues(e,t,o){const n=e.querySelectorAll(".quiz-options .option-item");Array.from(n).forEach((e=>{e.classList.contains("active")&&e.click()})),Array.from(n).forEach((e=>{let t="";const n=e.querySelector(".html-content-box");if(n)t=n.textContent.trim();else{t=e.textContent.trim().replace(/^[A-Z]\./,"").trim()}o.includes(t)&&e.click()}))}}class HomeworkProcessor{constructor(){this.homeworkData=[]}parseHomework(){this.homeworkData=[];let e=[];const t=null!==document.querySelector(".mark_table.padTop20.ans-cc"),o=null!==document.querySelector(".mark_table.padTop60.ans-cc");return(t||o)&&(e=document.querySelectorAll(".questionLi.singleQuesId")),0===e.length?(console.log("未找到作业题目容器"),[]):(Array.from(e).forEach(((e,n)=>{const r=this._getQuestionType(e,t);if(!["单选题","多选题","判断题"].includes(r))return;const s={questionId:e.id||`homework_question_${n+1}_${r}`,questionType:r,questionContent:this._getQuestionContent(e,t),options:this._getOptionValues(e,t),myAnswerValues:[],correctAnswerValues:[]};if(t)s.myAnswerValues=this._parseAnsweringValues(e,r);else if(o){const{myValues:t,correctValues:o}=this._parseReviewedValues(e,r,s.options);s.myAnswerValues=t,s.correctAnswerValues=o}this.homeworkData.push(s)})),this.homeworkData)}importAnswersByString(e){const t=e.split(/\s+/).filter((e=>""!==e.trim()));if(0===t.length)return void console.error("输入字符串格式错误，未找到有效答案");const o=null!==document.querySelector(".mark_table.padTop20.ans-cc");if(!o)return void console.error("仅支持答题中场景导入答案");const n=document.querySelectorAll(".questionLi.singleQuesId");if(0===n.length)return void console.error("未找到题目容器，无法导入答案");let r=0;Array.from(n).forEach(((e,n)=>{const s=this._getQuestionType(e,o);if(!["单选题","多选题","判断题"].includes(s))return void console.log(`第${n+1}题（${s}）不是单选/多选/判断题，跳过`);if(r>=t.length)return void console.log(`答案已用完，剩余题目（从第${n+1}题开始）未匹配`);const{options:i,codeToValueMap:l}=this._getOptionsWithCodeMap(e,o);if(0===i.length)return void console.log(`第${n+1}题未找到有效选项，跳过`);const a=t[r],c=this._parseAnswerToValues(a,i,l,s);c.length>0?(console.log(`为第${n+1}题（${s}）匹配答案：${a}`),this._restoreAnswerByValues(e,s,c),r++):console.log(`第${n+1}题未找到与"${a}"匹配的选项，跳过`)})),r<t.length?console.warn(`尚有${t.length-r}个答案未匹配`):console.log(`已完成所有${r}个答案的匹配`)}exportJson(){return this.parseHomework(),JSON.stringify(this.homeworkData)}importJson(e){try{const t=JSON.parse(e);if(!Array.isArray(t))return void console.error("导入数据格式错误，应为数组");const o=null!==document.querySelector(".mark_table.padTop20.ans-cc");if(!o)return void console.error("仅支持答题中场景导入JSON答案");const n=new Map;t.forEach((e=>{e.questionId&&["单选题","多选题","判断题"].includes(e.questionType)&&n.set(e.questionId,e)}));const r=document.querySelectorAll(".questionLi.singleQuesId");if(0===r.length)return void console.error("未找到题目容器，无法恢复答案");Array.from(r).forEach((e=>{const t=this._getQuestionType(e,o),r=e.id||"",s=n.get(r);if(!s||!["单选题","多选题","判断题"].includes(t))return;const i=s.correctAnswerValues.length>0?s.correctAnswerValues:s.myAnswerValues;i.length>0&&this._restoreAnswerByValues(e,t,i)})),console.log("答案恢复完成")}catch(e){console.error("导入失败：",e)}}_getQuestionType(e,t){if(t)return e.getAttribute("typename")||"未知题型";{const t=e.querySelector(".mark_name .colorShallow");return t?t.textContent.replace(/[()]/g,"").trim():"未知题型"}}_getQuestionContent(e,t){if(t){const t=e.querySelector(".mark_name");if(t)return t.textContent.replace(/^\d+\./,"").replace(/\(.*?\)/,"").trim()}else{const t=e.querySelector(".qtContent");if(t)return t.textContent.trim()}return"未知题目"}_getOptionValues(e,t){const o=[];if(t){const t=e.querySelectorAll(".answer_p");Array.from(t).forEach((e=>{const t=e.textContent.trim();t&&o.push(t)}))}else{const t=e.querySelectorAll(".qtDetail li");Array.from(t).forEach((e=>{const t=e.textContent.replace(/^[A-Z]\./,"").trim();t&&o.push(t)}))}return o}_getOptionsWithCodeMap(e,t){const o=[],n=new Map,r=["A","B","C","D","E"];if(t){const t=e.querySelectorAll(".answerBg");Array.from(t).forEach(((e,t)=>{const s=e.querySelector(".answer_p"),i=s?s.textContent.trim():"";i&&o.push(i);const l=e.querySelector(".num_option, .num_option_dx");let a=l?l.textContent.trim():"";!a&&t<r.length&&(a=r[t]),a&&i&&n.set(a,i)}))}else{const t=e.querySelectorAll(".qtDetail li");Array.from(t).forEach(((e,t)=>{const s=e.textContent.trim(),i=s.match(/^([A-Z])\./);let l=i?i[1]:"";!l&&t<r.length&&(l=r[t]);const a=s.replace(/^[A-Z]\./,"").trim();a&&o.push(a),l&&a&&n.set(l,a)}))}return{options:o,codeToValueMap:n}}_parseAnswerToValues(e,t,o,n){if("判断题"===n&&2===t.length){const[o,n]=t;if(["A","对","正确"].includes(e))return[o];if(["B","错","错误"].includes(e))return[n]}const r=[];for(const t of e)o.has(t)&&r.push(o.get(t));if(r.length>0)return r;const s=("多选题"===n?e.split(/\s+/):[e]).filter((e=>t.includes(e.trim())));return s.length>0?s:[]}_parseAnsweringValues(e,t){const o=[],n=e.querySelectorAll(".check_answer, .check_answer_dx");return Array.from(n).forEach((e=>{const t=e.closest(".answerBg").querySelector(".answer_p");if(t){const e=t.textContent.trim();e&&o.push(e)}})),o}_parseReviewedValues(e,t,o){const n={myValues:[],correctValues:[]},r=this._getOptionsWithCodeMap(e,!1).codeToValueMap,s=e.querySelector(".stuAnswerContent");if(s){const e=s.textContent.trim();n.myValues=this._parseAnswerToValues(e,o,r,t)}const i=e.querySelector(".rightAnswerContent");if(i){const e=i.textContent.trim();n.correctValues=this._parseAnswerToValues(e,o,r,t)}return n}_restoreAnswerByValues(e,t,o){const n=e.querySelectorAll(".check_answer, .check_answer_dx");Array.from(n).forEach((e=>{const t=e.closest(".answerBg");t&&t.click()}));const r=e.querySelectorAll(".answerBg");Array.from(r).forEach((e=>{const n=e.querySelector(".answer_p");if(n){const r=n.textContent.trim();if(o.includes(r)&&(e.click(),["单选题","判断题"].includes(t)))return!1}}))}}class AdvancedWebTool{constructor(){this.url=new URL(window.location.href).pathname,console.log(this.url),this.jsManager={getUrlKey(){return this.url},getStoredJS(){const e=this.getUrlKey();return localStorage.getItem(e)||""},editStoredJS(e){try{const t=this.getUrlKey();return localStorage.setItem(t,e||""),!0}catch(e){return console.error("保存JS代码失败:",e),!1}},executeStoredJS(){try{const jsCode=this.getStoredJS();return!!jsCode&&(eval(jsCode),!0)}catch(e){return console.error(`自动化出错:${e}\n请修复或移除js`),!1}},deleteStoredJS(){try{const e=this.getUrlKey(),t=null!==localStorage.getItem(e);return localStorage.removeItem(e),t}catch(e){return console.error("删除JS代码失败:",e),!1}}},this.addressManager={getKey:()=>"qcxs_address",getAllAddress(){const e=localStorage.getItem(this.getKey());return e?JSON.parse(e):[{remark:"添加位置"}]},saveAddress(e){localStorage.setItem(this.getKey(),JSON.stringify(e))},addAddress(e){e&&"object"==typeof e&&"name"in e||ToolClass.showTip("添加的记录必须是包含 name 的对象");const t=this.getAllAddress();t.unshift(e),this.saveAddress(t)},deleteAddress(e){const t=this.getAllAddress();return"number"!=typeof e||e<0||e>=t.length?(console.warn("无效的记录下标"),!1):(t.splice(e,1),this.saveAddress(t),!0)},getAddressMenuItems(e){"function"!=typeof e&&showTip("callback不是函数！");return this.getAllAddress().map(((t,o)=>({name:this.getshow(t),callback:()=>e(o,t)})))},getshow:e=>(e.remark||"").trim().length>0?e.remark:e.name},this.processor=null,this.erudaVisible=null,this.init()}init(){this.initJS(),this.menuItems=[{name:"eruda",callback:()=>{if(window.eruda)return this.erudaVisible=!this.erudaVisible,void(this.erudaVisible?eruda.init():eruda.destroy());ToolClass.loadScript("https://cdn.jsdelivr.net/npm/eruda",(()=>{eruda.init(),this.erudaVisible=!0}))}},{name:"自动化",callback:()=>{const e=this.jsManager.getStoredJS();this.createInputDialog("当前网页启动时自动执行的js，为空删除",(e=>{if(e.trim()){const t=this.jsManager.editStoredJS(e);ToolClass.showTip(t?"保存成功":"保存失败")}else{const e=this.jsManager.deleteStoredJS();ToolClass.showTip(e?"成功删除记录":"无记录可删除或删除失败")}}),e)}},{name:"编辑网页",callback:()=>{document.body.contentEditable=document.body.isContentEditable?"false":"true",ToolClass.showTip(document.body.isContentEditable?"娱乐功能，勿做他用":"关闭编辑")}},{name:"刷新",callback:()=>window.location.reload()},{name:"加载url",callback:()=>ToolClass.loadUrl()}],"/exam-ans/exam/phone/preview"===this.url?this.processor=new ExamProcessor:"/pptTestPaperStu/startAnswer"===this.url||"/widget/weixin/vote/stuVoteController/preVote"===this.url||"/pptTestPaperStu/reStartAnswerV2"===this.url?this.processor=new InClassExerciseProcessor:"/mooc-ans/mooc2/work/dowork"!==this.url&&"/pptTestPaperStu/reStartAnswerV2"!==this.url&&"/mooc-ans/mooc2/work/view"!==this.url||(this.processor=new HomeworkProcessor),this.processor&&(this.menuItems.unshift({name:"导出题目",callback:()=>this.outputExamAnswerByMe()}),this.menuItems.unshift({name:"导入json",callback:()=>this.inputExamAnswerForJson()}),this.menuItems.unshift({name:"导入Str",callback:()=>this.inputExamAnswerForStr()})),this.executeDelayTask(),this.deletePptactiveCache(),this.jsManager.executeStoredJS(),this.launchEvent(),this.bindDblclickEvent()}initJS(){window.jQuery||ToolClass.loadScript("https://mooc1-api.chaoxing.com/mooc-ans/js/set/phone/jquery-1.9.0.min.js",(()=>{console.log("启用jquery")})),window.jsBridge||ToolClass.loadScript("https://mooc1-api.chaoxing.com/mooc-ans/js/phone/protocolChaoXing/CXJSBridge.js",(()=>{const e=document.createElement("iframe");e.src="jsbridge://NotificationReady",e.style.display="none",document.body.appendChild(e),console.log("启用JSBridge")})),window.AppUtils||ToolClass.loadScript("https://mooc1-api.chaoxing.com/mooc-ans/js/phone/app.utils.js",(()=>{console.log("启用AppUtils")}))}launchEvent(){let t=[{menu:"菜单",option:"this.showItemsMenu()"},{menu:"浏览器打开",option:"\n            AppUtils.openUrl({\n                loadType: 2, \n                webUrl: window.location.href\n            });\n        "},{menu:"网页文字",option:"ToolClass.print(ToolClass.getElementSelectedText(document.body))"},{menu:"加载url",option:"ToolClass.loadUrl()"},{menu:"PC中心",option:"  \n            AppUtils.openUrl({\n                loadType: 1, \n                webUrl: 'https://mooc2-ans.chaoxing.com/mooc2-ans/visit/interaction'\n            });\n            "}];"/exam-ans/exam/test/reVersionTestStartNew"===this.url?t.push({menu:"切换考试端",option:"\n                const url = new URL(window.location.href);\n                const params = new URLSearchParams(window.location.search);\n                if (params.get('isphone') !== 'true') {\n                    url.searchParams.set('isphone', 'true');\n                } else {\n                    url.searchParams.delete('isphone');\n                }\n                window.location.href = url.href;\n        "}):"/pptTestPaperStu/startAnswer"===this.url&&t.unshift({menu:"修改",option:"openReEdit()"});let o=setInterval((()=>{if(window.AppUtils&&(this.menuItems.push({name:"个人信息",callback:()=>{AppUtils.getUserInfo("cx_fanya",(function(e){ToolClass.print(e)}))}}),this.menuItems.push({name:"退出",callback:()=>{jsBridge.postNotification("CLIENT_EXIT_LEVEL",{level:1})}}),"/widget/weixin/sign/stuSignController/preSign"!==this.url&&"/newsign/preSign"!==this.url||t.push({menu:"位置库",option:"this.showAdressList()"}),t.forEach((e=>{e.option=`(function() { ${e.option} })()`,e.option=e.option.replace(/this/g,"window.AdvancedWebTool")})),AppUtils.customMenu({menu:"高级",children:t}),clearInterval(o),AppUtils.isNewVersionNew=()=>!0,AppUtils.isNewVersion=()=>!0,AppUtils.isChaoXingStudy=()=>!0,window.checkClientSignatureSupport))try{checkClientSignatureSupport=()=>!1}catch(t){console.log(e)}}),1e3)}showAdressList(){this.createSelectDialog(this.addressManager.getAddressMenuItems(((e,t)=>{if("添加位置"===t.remark){try{const e={name:$("#paramAddress").val()||$("#address").text()||"地址(教师端显示)",latitude:$("#latitude").val()||"纬度(数字)",longitude:$("#longitude").val()||"经度(数字)",remark:""};this.createInputDialog("确认添加此位置？",(e=>{this.addressManager.addAddress(JSON.parse(e))}),e)}catch(e){ToolClass.print("发生错误"+e)}return}const o=[{name:"签到",callback:()=>{try{$("#paramAddress").val(t.name),$("#latitude").val(t.latitude),$("#longitude").val(t.longitude),window.sign()}catch(e){ToolClass.print("发生错误："+e)}}},{name:"备注",callback:()=>{this.createInputDialog("请输入备注",(o=>{this.addressManager.deleteAddress(e),t.remark=o,this.addressManager.addAddress(t)}),t.remark)}},{name:"编辑",callback:()=>{this.createInputDialog("编辑",(t=>{this.addressManager.deleteAddress(e),this.addressManager.addAddress(JSON.parse(t))}),t)}},{name:"删除",callback:()=>{this.addressManager.deleteAddress(e)}}];this.createSelectDialog(o,this.addressManager.getshow(t))})),"位置库：")}bindDblclickEvent(){document.addEventListener("dblclick",(e=>{ToolClass.showTip("菜单")}))}showItemsMenu(){this.createSelectDialog(this.menuItems,"高级功能")}outputExamAnswerByMe(){ToolClass.print(this.processor.exportJson())}inputExamAnswerForJson(){this.createInputDialog("请输分享的json：",(e=>{e.trim()?this.processor.importJson(e):ToolClass.showTip("不能为空")}))}inputExamAnswerForStr(){this.createInputDialog("请输ai回答的以空格连接的答案：",(e=>{e.trim()?this.processor.importAnswersByString(e):ToolClass.showTip("不能为空")})),ToolClass.print(`${ToolClass.getElementSelectedText(document.body)}\n请基于提供的全部题目内容，仅针对其中的选择题（含单选、多选） 和判断题进行作答，完全忽略简答题、论述题等其他题型。具体要求如下：\n识别题目类型：准确区分单选（唯一答案）、多选（多个答案）、判断（需明确 “对” 或 “错” 对应的选项，如题目要求判断后选 A/B 对应对 / 错，则返回 A 或 B）。\n答案格式：\n单选题答案直接返回选项（如 A、B）；\n多选题答案用大写字母拼接（如 BC、ACD）；\n判断题返回题目指定的 “对” 或 “错” 对应的选项（如题目标注 “对选 A，错选 B” 则返回 A 或 B）。\n排序与分隔：按题目在内容中出现的原始顺序排列答案，不同题目答案之间用单个空格分隔，不添加任何额外字符、标点或说明。\n请严格遵循上述规则，仅输出整理后的答案字符串。`)}createInputDialog(e,t,o=""){ToolClass.print(o,t,e)}createSelectDialog(e,t="请选择"){this.removeExistingDialogs(1234);const o=`sd-${Date.now()}`,n=document.createElement("div");n.innerHTML=`<div class="mask" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);z-index:1234;" onclick="this.parentElement.remove()">\n        <div class="dialog" style="text-align:-webkit-auto;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:300px;border:1px solid #ccc;border-radius:4px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.15);padding:0;display:block;z-index:9996;">\n      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-bottom:1px solid #eee;"><span>${t}</span>\n      <button style="background:none;border:none;font-size:16px;cursor:pointer;padding:0;line-height:1;" onclick="this.closest('.dialog').parentElement.remove()">×</button></div><div style="max-height:200px;overflow-y:auto;padding:8px 0;scrollbar-width:thin;"><ul style="list-style:none;margin:0;padding:0;">${e.map(((e,t)=>`<li data-i="${t}" style="padding:8px 16px;cursor:pointer;" onclick="this.parentElement.querySelectorAll('li').forEach(li => li.style.background='');this.style.background='#e6f3ff';this.querySelector('input').checked=true;"><input type="radio" name="${o}" id="${o}-${t}" value="${t}" style="margin-right:8px;"><label for="${o}-${t}">${e.name}</label></li>`)).join("")}</ul></div><div style="display:flex;justify-content:flex-end;gap:8px;padding:8px 16px;border-top:1px solid #eee;"><button style="padding:6px 16px;border-radius:4px;cursor:pointer;background:#fff;border:1px solid #ccc;" onclick="this.closest('.dialog').parentElement.remove()">取消</button>\n      <button class="okay" style="padding:6px 16px;border-radius:4px;cursor:pointer;background:#409eff;color:#fff;border:none;">确定</button></div></div></div>`,document.body.appendChild(n);const r=n.querySelector('input[type="radio"]');r&&(r.checked=!0,r.closest("li").style.background="#e6f3ff"),n.querySelector(".dialog").addEventListener("click",(e=>{e.stopPropagation()})),n.querySelector(".okay").addEventListener("click",(()=>{const t=n.querySelector("input:checked")?.value;if(void 0!==t){const o=e[t];"function"==typeof o.callback&&o.callback()}n.remove()}))}executeDelayTask(){setTimeout((()=>{try{this.enableCopyAndHideWatermark(),this.enableEditorPaste(),ToolClass.recConsoleLog(),}catch(e){console.error("延迟任务执行失败:",e)}}),500)}enableCopyAndHideWatermark(){if(document.querySelector(".qcxsStyle"))return;const e=document.createElement("style");e.className="qcxsStyle",e.textContent="\n      * {\n        -webkit-touch-callout: default !important;\n        -webkit-user-select: text !important;\n        -khtml-user-select: text !important;\n        -moz-user-select: text !important;\n        -ms-user-select: text !important;\n        user-select: text !important;\n      }\n      .mask_div { display: none !important; }\n    ",document.head.appendChild(e),document.body.removeAttribute("onselectstart"),document.documentElement.style.userSelect="unset"}enableEditorPaste(){window.editors&&Array.isArray(window.editors)&&window.editors.forEach((e=>{e&&e.ueditor&&(e.ueditor.__allListeners.beforepaste=null)})),window.editor&&editor.ueditor&&(editor.ueditor.__allListeners.beforepaste=null),window.UE&&UE.instants&&"object"==typeof UE.instants&&Object.entries(UE.instants).forEach((([e,t])=>{try{t.options&&(t.options.disablePasteImage=!1),t.removeListener&&t.removeListener("beforepaste",window.editorPaste)}catch(t){console.error("编辑器粘贴配置失败：",e,t)}}))}removeExistingDialogs(e){document.querySelectorAll(`[style*="z-index:${e}"]`).forEach((e=>e.remove()))}deletePptactiveCache(){Object.keys(localStorage).forEach((e=>{e.startsWith("pptactive")&&(console.log("已删除签到记录缓存：",e,localStorage.getItem(e)),localStorage.removeItem(e))}))}}window.AdvancedWebTool=new AdvancedWebTool;
//# sourceMappingURL=/sm/f8e09c3a1925da1c589a8ae84f36eea2c73ce4331416695696bcdaa6e4455b69.map